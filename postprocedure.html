<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
<title>Post Procedure</title>

<style>
html, body {
  height:100%;
  margin:0;
  background:#fff;
  overflow:hidden;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
}

.frame-window{
  position:fixed;
  inset:0;
  overflow:hidden;
  background:#fff;
}

iframe{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  border:0;
  display:block;
  transform:none!important;
  -webkit-overflow-scrolling:touch;
}

/* === BLACK DATE BAR === */
#bottomBlocker{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  height:0px;              /* controlled by JS */
  background:#000;
  color:#fff;
  z-index:80;
  pointer-events:auto;

  display:flex;
  align-items:center;
  justify-content:center;

  font-size:20px;          /* LARGE */
  font-weight:700;
  letter-spacing:1.5px;
  text-transform:uppercase; /* ALL CAPS */
}

/* ADMIN PANEL */
.controls{
  position:fixed;
  left:0;right:0;top:0;
  padding:10px 12px;
  background:rgba(255,255,255,0.94);
  border-bottom:1px solid rgba(0,0,0,0.12);
  backdrop-filter:blur(10px);
  z-index:90;
}
.controls.hidden{display:none;}

.row{display:flex;align-items:center;gap:10px;margin:8px 0;}
.row label{width:170px;font-size:14px;}
.row input[type="range"]{flex:1;}
.val{width:80px;text-align:right;font-variant-numeric:tabular-nums;}

.pill{
  display:inline-block;
  padding:2px 8px;
  border:1px solid rgba(0,0,0,0.15);
  border-radius:999px;
  font-size:12px;
  opacity:.85;
  margin-left:6px;
}

.hint{font-size:12px;opacity:.75;margin-top:6px;line-height:1.25;}
.btnrow{display:flex;gap:10px;flex-wrap:wrap;}

.btn{
  border:1px solid rgba(0,0,0,0.18);
  background:rgba(0,0,0,0.06);
  padding:8px 10px;
  border-radius:10px;
  font-size:14px;
}

#adminBtn{
  position:fixed;
  top:10px;
  right:10px;
  width:44px;
  height:44px;
  border-radius:999px;
  border:none;
  background:rgba(0,0,0,0.15);
  color:#000;
  font-size:20px;
  z-index:100;
  backdrop-filter:blur(6px);
  display:flex;
  align-items:center;
  justify-content:center;
}
#adminBtn.hidden{display:none;}

#exitScreen{
  position:fixed;
  inset:0;
  background:#fff;
  z-index:200;
  display:none;
  padding:16px;
}
#exitScreen.show{display:block;}

.bigbtn{
  display:inline-block;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,0.18);
  background:rgba(0,0,0,0.06);
  font-size:16px;
}

.noselect{user-select:none;-webkit-user-select:none;}
</style>
</head>

<body class="noselect">

<button id="adminBtn">âš™</button>

<div class="controls hidden" id="controls">
  <div class="row">
    <label>Mode <span class="pill" id="modePill">normal</span></label>
  </div>

  <div class="row">
    <label>Hide bottom (normal)</label>
    <input id="maskNormal" type="range" min="0" max="260" step="2"/>
    <div class="val" id="maskNormalVal"></div>
  </div>

  <div class="row">
    <label>Hide bottom (keyboard)</label>
    <input id="maskKeyboard" type="range" min="0" max="380" step="2"/>
    <div class="val" id="maskKeyboardVal"></div>
  </div>

  <div class="row">
    <label>Nudge up/down</label>
    <input id="nudgePx" type="range" min="-200" max="200" step="2"/>
    <div class="val" id="nudgeVal"></div>
  </div>

  <div class="btnrow">
    <button class="btn" id="btnReload">Reload page</button>
  </div>
</div>

<div class="frame-window">
  <iframe id="formFrame"
    src="https://www.howitzer.ink/postprocedure.html"
    scrolling="yes"></iframe>
</div>

<div id="bottomBlocker">
  <span id="todayDate"></span>
</div>

<div id="exitScreen">
  <h1>Admin exit</h1>
  <button class="bigbtn" id="btnReturn">Return</button>
</div>

<script>
const PAGE_URL="https://www.howitzer.ink/postprocedure.html";
const EXTRA_SCROLL_PX=140;

const frame=document.getElementById('formFrame');
const bottomBlocker=document.getElementById('bottomBlocker');
const todayDateEl=document.getElementById('todayDate');

const maskNormal=document.getElementById('maskNormal');
const maskKeyboard=document.getElementById('maskKeyboard');
const nudgePx=document.getElementById('nudgePx');

const maskNormalVal=document.getElementById('maskNormalVal');
const maskKeyboardVal=document.getElementById('maskKeyboardVal');
const nudgeVal=document.getElementById('nudgeVal');
const modePill=document.getElementById('modePill');

const savedMaskNormal=parseInt(localStorage.getItem('maskBottomNormalPx')||'90',10);
const savedMaskKeyboard=parseInt(localStorage.getItem('maskBottomKeyboardPx')||'130',10);
const savedNudge=parseInt(localStorage.getItem('nudgeUpPx')||'0',10);

maskNormal.value=savedMaskNormal;
maskKeyboard.value=savedMaskKeyboard;
nudgePx.value=savedNudge;

/* === TODAY DATE === */
function updateTodayDate(){
  const now=new Date();
  const formatted=now.toLocaleDateString(undefined,{
    weekday:'long',
    year:'numeric',
    month:'long',
    day:'numeric'
  });
  todayDateEl.textContent=formatted.toUpperCase();
}
updateTodayDate();

/* === keyboard detection === */
let keyboardUp=false;
let baselineHeight=null;

function getViewportHeight(){
  return(window.visualViewport&&window.visualViewport.height)
    ?window.visualViewport.height
    :window.innerHeight;
}

function updateKeyboardState(){
  const h=getViewportHeight();
  if(baselineHeight===null)baselineHeight=h;
  const shrink=baselineHeight-h;
  keyboardUp=shrink>120;
}

/* === APPLY CLIP === */
function applyClipAndSave(){
  updateKeyboardState();

  const cutPx=keyboardUp?parseInt(maskKeyboard.value,10):parseInt(maskNormal.value,10);
  const n=parseInt(nudgePx.value,10);

  frame.style.clipPath=`inset(0px 0px ${cutPx}px 0px)`;
  frame.style.webkitClipPath=`inset(0px 0px ${cutPx}px 0px)`;
  frame.style.top=`${n}px`;

  frame.style.height=`calc(100% + ${cutPx+EXTRA_SCROLL_PX}px)`;

  bottomBlocker.style.height=`${cutPx}px`;

  maskNormalVal.textContent=`${maskNormal.value}px`;
  maskKeyboardVal.textContent=`${maskKeyboard.value}px`;
  nudgeVal.textContent=`${n}px`;

  modePill.textContent=keyboardUp?'keyboard':'normal';

  localStorage.setItem('maskBottomNormalPx',maskNormal.value);
  localStorage.setItem('maskBottomKeyboardPx',maskKeyboard.value);
  localStorage.setItem('nudgeUpPx',n);
}

maskNormal.addEventListener('input',applyClipAndSave);
maskKeyboard.addEventListener('input',applyClipAndSave);
nudgePx.addEventListener('input',applyClipAndSave);

window.addEventListener('resize',applyClipAndSave);
if(window.visualViewport){
  window.visualViewport.addEventListener('resize',applyClipAndSave);
  window.visualViewport.addEventListener('scroll',applyClipAndSave);
}

applyClipAndSave();
</script>

</body>
</html>
